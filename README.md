# OpenMakita ESP - 牧田電池診斷工具

這是一個基於 ESP32 的 Web 應用工具，用於讀取、解析並視覺化顯示牧田 (Makita) LXT 系列鋰電池內建 BMS (電池管理系統) 的診斷數據。

本專案基於 [GitHub - Belik1982/esp32-makita-bms-reader](https://github.com/Belik1982/esp32-makita-bms-reader) 的出色研究，並在其基礎上進行了功能增強與介面優化。

## 功能特點

- **網頁化介面 (Web UI)**：無需安裝任何手機 App，透過 Wi-Fi 連接 ESP32 熱點，即可在瀏覽器中操作。
- **強制門戶 (Captive Portal)**：連接 Wi-Fi 熱點後，多數裝置會自動彈出登入頁面，直接導向操作介面。
- **完整數據顯示**：
  - **靜態資訊**：讀取電池型號、序號、製造日期、設計容量、韌體版本等。
  - **動態數據**：即時更新每串電芯的電壓、電池溫度 (最多三組)。
  - **進階紀錄**：顯示總充電循環次數、過放/過載次數、各項錯誤計數以及軟體熔絲狀態。
- **智慧控制器偵測**：自動識別並相容標準 (STANDARD) 與 F0513 等不同類型的電池控制器。
- **電池健康度 (SOH) 估算**：根據循環次數與錯誤紀錄，在前端動態估算電池的健康狀態百分比。
- **電芯視覺化**：以圖形化方式顯示每串電芯的電壓與相對電量，壓差過大時會以顏色警示。
- **多國語言支援**：介面支援動態語言切換 (英文、繁體中文、日文、德文、俄文、西班牙文)。
- **韌體更新 (OTA)**：可透過網頁介面直接上傳更新 ESP32 的韌體 (`firmware.bin`) 或網頁檔案系統 (`spiffs.bin`)。
- **雙重數據紀錄與匯出**：
    - **MCU 端自動記錄**: 每次讀取動態數據時，會自動將完整資訊附加到儲存於 ESP32 的 `datalog.csv` 檔案中，並具備日誌自動輪替功能，防止檔案無限增大。<!-- 上限800筆記錄 -->
    - **客戶端手動匯出**: 可將當前連線期間讀取的所有歷史數據，從瀏覽器端匯出為 CSV 檔案。
- **日誌管理**: 可直接從網頁介面下載或清除儲存在 MCU 上的 `datalog.csv` 檔案。

## 硬體建置所需元件

1.  **ESP32 開發板**：例如 NodeMCU-32S 或任何功能相似的開發板。本程式使用：D4、D5、VIN5V、GND、VIN3.3V
2.  **邏輯電平轉換模組**：3.3V/5V 轉換模組，可用NPN電晶體2SD882 & S8050、2.2K、4.7K、1K電阻製作。
    <!--因為 ESP32 的 GPIO 為 3.3V，而電池的通訊腳位為 5V，直接連接會損壞 ESP32-->
3.  **牧田電池端子**：可以從舊的充電器拆下、3D列印的電池座、淘寶等、<!-- 低成本 XH 2.54-7PIN公座90度 -->
4.  **杜邦線**：若干條，用於連接。

### 設備連接圖

![設備連接圖](https://github.com/and14122001/nodemcu-makita-bms-tool/blob/main/connection_diagram.jpg)

## 軟體安裝

本專案建議使用 **Visual Studio Code** 搭配 **PlatformIO** 擴充功能進行編譯與上傳。

1.  **安裝 VS Code 與 PlatformIO**：如果您尚未安裝，請先完成此步驟。
2.  **取得專案**：
    ```bash
    git clone https://github.com/your-repo/esp32-makita-bms-reader-main.git
    ```
3.  **開啟專案**：在 VS Code 中，點擊 `File > Open Folder...` 並選擇您剛剛複製下來的專案資料夾。
4.  **編譯與上傳**：
    - 打開 PlatformIO CLI 終端 (在 VS Code 底部狀態列點擊 PlatformIO 圖示，選擇 `Miscellaneous > New Terminal`)。
    - **首次安裝**需要上傳主程式與檔案系統：
      ```sh
      # 上傳主程式
      pio run --target upload

      # 上傳 data 資料夾中的所有網頁檔案
      pio run --target uploadfs
      ```
    - **後續更新**可以只上傳變更的部分。

## 使用方法

1.  **啟動設備**：為 ESP32 通電。
2.  **連接 Wi-Fi**：在您的電腦或手機上，搜尋 Wi-Fi 網路，找到一個名為 `Makita_BMS_Tool` 的熱點 (AP) 並連接。此熱點預設為開放網路，沒有密碼。
3.  **開啟介面**：打開瀏覽器，訪問 `http://192.168.4.1`。
4.  **連接電池**：將牧田電池安裝到您製作的端子上。
5.  **開始操作**：
    - 點擊 **`1. 讀取資訊`** 來辨識電池型號並讀取靜態數據。
    - 成功後，點擊 **`2. 更新數據`** 來讀取即時的電芯電壓與溫度。
    - 其他功能按鈕（如清除故障碼、測試 LED）將在讀取數據後根據電池支援情況自動啟用。

## 授權 (License)

本專案採用 MIT License 授權。詳情請見 LICENSE 檔案。

## 致謝 (Acknowledgements)

本專案的實現，離不開以下個人與專案所分享的基礎研究、程式碼與寶貴知識。
詳細貢獻者列表請參閱 ATTRIBUTIONS.md 檔案。


---

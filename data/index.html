<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Makita BMS Tool</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <header class="topbar">
        <div class="container" style="width: 100%; display: flex; align-items: center;">
            <div class="header-left">
                <div class="logo">üîã</div>
                <div class="title-block">
                    <div class="title">Makita BMS Tool</div>
                    <div class="subtitle" id="subtitle" data-lang-key="subtitle"></div>
                </div>
            </div>
            <div class="header-right" style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                <button id="btnTheme" class="lang" style="font-size: 1.2rem; margin-right: 8px; cursor: pointer;">üåó</button>
                <div class="lang-block">
                    <select id="langSelect" class="lang-dropdown"></select>
                </div>
                <div class="header-status" id="statusWidget" >
                    <div id="statusText" data-lang-key="initial_status">‚Ä¶</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div id="limitedSupportAlert" class="alert info" style="display: none;"></div>

        <section class="actions card">
            <div class="actions-grid">
                <div class="button-row mt-10">
                    <div class="button-flex">
                        <button id="btnReadStatic" class="big btn-data" data-lang-key="readStatic"></button>
                        <button id="btnReadDynamic" class="big" data-lang-key="readDynamic" disabled></button>
                    </div>
                </div>
                <div class="hint-row">
                    <div class="hint-pair">
                        <div class="btn-hint" id="hintReadStatic" data-lang-key="hintReadStatic"></div>
                        <div class="btn-hint" id="hintReadDynamic" data-lang-key="hintReadDynamic"></div>
                    </div>
                </div>

                <div id="serviceActions" class="service-actions-block">
                    <div class="button-row mt-10">
                        <div class="button-flex">
                            <button id="btnClearErrors" class="big" data-lang-key="clearErrors" disabled></button>
                            <button id="btnLed" class="big" data-lang-key="ledTest" disabled></button>
                        </div>
                    </div>
                    <div class="hint-row">
                        <div class="hint-pair">
                            <div class="btn-hint" id="hintClear" data-lang-key="hintClear"></div>
                            <div class="btn-hint" id="hintLed" data-lang-key="hintLed"></div>
                        </div>
                    </div>
                    <div class="button-row mt-10">
                        <div class="button-flex">
                            <button id="btnExport" class="big btn-data" data-lang-key="exportCSV"></button>
                        </div>
                    </div>
                    <div class="button-row mt-10">
                        <div class="button-flex">
                            <button id="btnMcuDownload" class="big btn-func" data-lang-key="mcu_csv_download"></button>
                            <button id="btnMcuDelete" class="big btn-service" data-lang-key="mcu_csv_clear"></button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="notification" style="display:none;"></div>
        </section>

        <section class="card" id="overviewCard" style="display: none;">
            <div class="card-header">
                <h2 id="sectionTitle" data-lang-key="sectionTitle"></h2>
            </div>

            <div class="kv kv-grid" id="data-table"></div>

            <div id="advancedSection" style="display: none;">
                <hr class="divider">

                <div class="card-header">
                    <h2 data-lang-key="advDataTitle"></h2>
                </div>
                <div class="kv kv-grid">
                    <div class="kv-item">
                        <span class="key" data-lang-key="health_soh"></span>
                        <span class="value" data-field="health_soh" data-unit="%" data-color-ref="_sohColor">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="over_discharge"></span>
                        <span class="value" data-field="over_discharge" data-unit="times">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="over_load"></span>
                        <span class="value" data-field="over_load" data-unit="times">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="err_cnt_04"></span>
                        <span class="value" data-field="err_cnt_04" data-warn-gt="0">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="err_cnt_05"></span>
                        <span class="value" data-field="err_cnt_05" data-warn-gt="0">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="err_cnt_06"></span>
                        <span class="value" data-field="err_cnt_06" data-warn-gt="0">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="err_cnt_07"></span>
                        <span class="value" data-field="err_cnt_07" data-warn-gt="0">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="fuse_blown"></span>
                        <span class="value" data-field="fuse_blown" data-type="fuse">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="tempCell1"></span>
                        <span class="value" data-field="temp1" data-unit="¬∞C">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="tempCell2"></span>
                        <span class="value" data-field="temp2" data-unit="¬∞C">--</span>
                    </div>
                    <div class="kv-item">
                        <span class="key" data-lang-key="tempBMS"></span>
                        <span class="value" data-field="temp3" data-unit="¬∞C">--</span>
                    </div>
                </div>

                <div class="battery-container">
                    <div id="cells-container"></div>
                </div>
                <div class="pack-summary" id="packSummary"></div>
            </div>
        </section>

        <details class="log-spoiler card small">
            <summary id="rawTitle" data-lang-key="rawTitle"></summary>
            <pre id="log" class="logbox"></pre>
        </details>

        <details class="card small ota-card">
            <summary data-lang-key="ota_title"></summary>
            <div class="ota-content">
                <form method="POST" action="/update" enctype="multipart/form-data" class="ota-form">
                    <input type="file" name="update" accept=".bin" class="ota-input">
                    <button type="submit" class="btn-data big" style="flex: 0 1 auto; padding: 5px 15px;"
                        data-lang-key="ota_btn_upload"></button>
                </form>
                <div class="ota-hint" data-lang-key="ota_hint"></div>

                <div style="margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 10px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-main);"
                        data-lang-key="ref_title">ÂèÉËÄÉ‰æÜÊ∫ê</div>
                    <div style="font-size: 0.8em; color: var(--text-sub); margin-bottom: 8px;" data-lang-key="ref_note">
                    </div>
                    <div id="ref-content" class="ref-window"></div>
                </div>
            </div>
        </details>
    </main>

    <footer class="footer">
        <div id="footerText" data-lang-key="footerText"></div>
        <div id="storageInfo" style="font-size: 0.8rem; color: var(--muted); margin-top: 4px;">
            SPIFFS: <span id="storageUsed">...</span> / <span id="storageTotal">...</span> KB 
            <span id="refreshStorage" style="cursor: pointer; font-size: 1rem;">üîÑ</span>
        </div>
    </footer>

    <script src="/i18n.js"></script>
    <script src="/constants.js"></script>
    <script src="/ws_client.js"></script>
    <script src="/app.js"></script>
</body>

</html>